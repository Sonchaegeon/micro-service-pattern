# 프로세스 간 통신

### 이 장에서 다룰 핵심 내용

- 다양한 통신 패턴 적용: 원격 프로시저 호출, 회로 차단기, 클라이언트 쪽 디스커버리, 자가 등록, 서버 쪽 디스커버리, 서드파티 등록, 비동기 메시징, 트랜잭셔널 아웃박스, 트랜잭션 로그 테일링, 발행기(publisher) 폴링
- 마이크로서비스 아키텍처에서 IPC의 중요성
- API 정의 및 발전
- 여러 가지 IPC와 각각의 트레이드오프
- 비동기 메시징으로통신하는 서비스의 장점
- 메시지를 DB 트랜잭션에 태워 확실하게 전송

마이크로서비스 아키텍처는 애플리케이션을 여러 개의 서비스로 구성하며, 서비스는 대부분 요청을 처리하기 위해 서로 협동한다. 서비스 인스턴스는 여러 머신에서 실행되는 프로세스 형태이므로 반드시 IPC를 통해 상호 작용해야 한다.

IPC 비중 = 모놀리식 < 마이크로서비스

## 3.1 마이크로서비스 아키텍처 IPC 개요

### 3.1.1 상호 작용 스타일

서비스 API에 알맞은 IPC를 선택하기 전에 클라이언트/서비스 간 상호 작용 스타일을 잘 살펴보면, 요건에서 벗어나는 일 없이 특정 IPC 기술의 세부 내용에 빠져 헤매는 일을 방지할 수 있다.

클라이언트/서비스 상호 작용 스타일은 두 가지 기준을 분류 할 수 있다.

1. 일대일/일대다 여부
   - 일대일: 각 클라이언트 요청은 정확히 한 서비스가 처리한다.
   - 일대다: 각 클라이언트 요청을 여러 서비스가 협동하여 처리한다.
2. 동기/비동기 여부
   - 동기: 클라이언트는 서비스가 제시간에 응답하리라 기대하고 대기 도중 블로킹 할 수 있다.
   - 비동기: 클라이언트가 블로킹하지 않는다. 응답은 즉시 전송괴지 않아도 된다. 

일대일 상호 작용 종류

- 요청/응답: 클라이언트는 서비스에 요청을 하고 응답을 기다린다. 클라이언트는 응답이 제때 도착하리라 기대하고 대기 도중 블로킹할 수 있다. 결과적으로 서비스가 서로 강하게 결합되는 상호 작용 스타일이다.
- 비동기 요청/응답: 클라이언트는 서비스에 요청을 하고 서비스는 비동기적으로 응답한다. 클라이언트는 대기 중에 블로킹하지 않고, 서비스는 오랫동안 응답하지 않을 수 있다.
- 단방향 알림: 클라이언트는 서비스에 일방적으로 요청만 하고 서비스는 응답을 보내지 않는다.

일대다 상호 작용 종류

- 발행/구독: 클라이언트는 알림 메시지를 발행하고, 여기에 관심 있는 0개 이상의 서비스(즉, 관심 있는 서비스가 없는 경우도 있음)가 메시지를 소비한다.
- 발행/비동기 응답: 클라이언트는 요청 메시지를 발행하고 주어진 시간 동안 관련 서비스가 응답하길 기다린다.

각 서비스마다 이런 상호 작용 스타일을 조합해서 사용하면 된다.

### 3.1.2 마이크로 서비스 API 정의

어떤 IPC를 선택하든, 서비스 API를 IDL(Inferface Definition Language, 인트페이스 정의 언어)로 정확하게 정의해야 한다. 선 설계 후 구현 방식으로 진행하면 클라이언트 니즈에 좀 더 부합한 서비스를 구축할 수 있다.

